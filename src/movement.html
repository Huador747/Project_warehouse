<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</title>
    <link rel="stylesheet" href="../styles/movement.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Hamburger button -->
    <button class="hamburger" id="hamburger-btn" aria-label="‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏≥‡∏ó‡∏≤‡∏á">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <div class="sidebar" id="sidebar">
      <div class="logo-container">
        <img src="/assets/logo.png" alt="Logo" class="logo" />
      </div>
      <button class="nav-btn" onclick="window.location.href='main.html'">
        <span class="nav-icon">üè†</span> ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
      </button>
      <button class="nav-btn" onclick="window.location.href='buyin.html'">
        <span class="nav-icon">üõí</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠
      </button>
      <button class="nav-btn" onclick="window.location.href='sale.html'">
        <span class="nav-icon">üí∏</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
      </button>
      <button class="nav-btn" onclick="window.location.href='inventory.html'">
        <span class="nav-icon">üì¶</span> ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
      </button>
      <button class="nav-btn " onclick="window.location.href='history.html'">
        <span class="nav-icon">üìë</span> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠-‡∏Ç‡∏≤‡∏¢
      </button>
      <button class="nav-btn active" onclick="window.location.href='movement.html'">
        <span class="nav-icon">üìà</span> ‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
      </button>
    </div>
    <!-- ‡∏™‡πà‡∏ß‡∏ô navbar -->
    <div class="navbar">
        <form class="navbar-form">
            <span class="navbar-text active">‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
        </form>
        <button class="logout-btn" id="logout-btn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
    <div class="main-content">
      <div class="controls">
        <div class="control-group">
          <label for="product-select">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡∏π‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</label>
          <select id="product-select">
              <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
              <!-- ‡πÄ‡∏ï‡∏¥‡∏° option ‡∏î‡πâ‡∏ß‡∏¢ JS -->
          </select>
        </div>
        <div class="control-group">
          <label for="period-type">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:</label>
          <select id="period-type">
              <option value="month">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
              <option value="quarter">‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™</option>
              <option value="year">‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</option>
          </select>
        </div>

        <div class="control-group">
          <label for="year-select" id="year-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ:</label>
          <select id="year-select"></select>
        </div>
      </div>
      <div id="inventory-info" style="margin-bottom:24px; font-weight:bold; color:#d35400;"></div>
      <canvas id="movementChart" width="900" height="400"></canvas>
    </div>
    <script type="module" src="../scripts/movement.js"></script>
    <script>
      const yearSelect = document.getElementById("year-select");
      const yearLabel = document.getElementById("year-label");

      async function populateYearSelect() {
        const { buyin, sale } = await fetchAll();
        const years = new Set();
        const safeDate = (d) => { try { return new Date(d); } catch { return new Date(NaN); } };
        (buyin || []).forEach(b => { const dt = safeDate(b.buyindate ?? b.date); if (!isNaN(dt)) years.add(dt.getFullYear()); });
        (sale || []).forEach(s => { const dt = safeDate(s.saleoutdate ?? s.date); if (!isNaN(dt)) years.add(dt.getFullYear()); });
        const sorted = Array.from(years).sort((a, b) => b - a);
        yearSelect.innerHTML = '';
        sorted.forEach(y => {
          const opt = document.createElement('option');
          opt.value = y;
          opt.textContent = y;
          yearSelect.appendChild(opt);
        });
        if (sorted.length) yearSelect.value = sorted[0];
      }
    </script>
</body>

</html>