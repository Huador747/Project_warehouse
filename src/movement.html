<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <title>р╕Бр╕гр╕▓р╕Яр╕Бр╕▓р╕гр╣Ар╕Др╕ер╕╖р╣Ир╕нр╕Щр╣Др╕лр╕зр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╣Бр╕ер╕░р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../styles/responsive/sidebar1180.css" />
  <link rel="stylesheet" href="../styles/movement.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <!-- Hamburger button -->
  <button class="hamburger" id="hamburger-btn" aria-label="р╣Ар╕бр╕Щр╕╣р╕Щр╕│р╕Чр╕▓р╕З">
    <span></span>
    <span></span>
    <span></span>
  </button>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-nav-btn">
      <button class="nav-btn" onclick="window.location.href='main.html'">
        <span class="nav-icon">ЁЯПа</span> р╕лр╕Щр╣Йр╕▓р╕лр╕ер╕▒р╕Б
      </button>
      <button class="nav-btn" onclick="window.location.href='buyin.html'">
        <span class="nav-icon">ЁЯЫТ</span> р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Лр╕╖р╣Йр╕н
      </button>
      <button class="nav-btn" onclick="window.location.href='sale.html'">
        <span class="nav-icon">ЁЯТ╕</span> р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Вр╕▓р╕в
      </button>
      <button class="nav-btn" onclick="window.location.href='history.html'">
        <span class="nav-icon">ЁЯУС</span> р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Лр╕╖р╣Йр╕н-р╕Вр╕▓р╕в
      </button>
      <button class="nav-btn" onclick="window.location.href='inventory.html'">
        <span class="nav-icon">ЁЯУж</span> р╕кр╕гр╕╕р╕Ыр╕Ир╕│р╕Щр╕зр╕Щр╕Др╕Зр╣Ар╕лр╕ер╕╖р╕нр╕кр╕┤р╕Щр╕Др╣Йр╕▓
      </button>
      <button class="nav-btn active" onclick="window.location.href='movement.html'">
        <span class="nav-icon">ЁЯУИ</span> р╕Бр╕гр╕▓р╕Яр╕Бр╕▓р╕гр╣Ар╕Др╕ер╕╖р╣Ир╕нр╕Щр╣Др╕лр╕зр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╣Бр╕ер╕░р╕Ир╕│р╕Щр╕зр╕Щр╣Ар╕Зр╕┤р╕Щ
      </button>
    </div>
    <div class="logo-container">
      <img src="/assets/logo.png" alt="Logo" class="logo" />
    </div>
  </div>
  <!-- р╕кр╣Ир╕зр╕Щ navbar -->
  <div class="navbar">
    <form class="navbar-form">
      <span class="navbar-text active">р╕лр╕Щр╣Йр╕▓р╕Бр╕▓р╕гр╣Ар╕Др╕ер╕╖р╣Ир╕нр╕Щр╣Др╕лр╕зр╕кр╕┤р╕Щр╕Др╣Йр╕▓</span>
      <button class="report-btn" id="report-btn">Report</button>
    </form>
    <div class="search-logout-row">
      <input type="text" class="search-product-input" placeholder="р╕Др╣Йр╕Щр╕лр╕▓р╕Фр╣Йр╕зр╕вр╕гр╕лр╕▒р╕к, р╕Кр╕╖р╣Ир╕нр╕кр╕┤р╕Щр╕Др╣Йр╕▓ р╕лр╕гр╕╖р╕нр╣Вр╕бр╣Ар╕Фр╕е..." />
      <button class="logout-btn" id="logout-btn">р╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ъ</button>
    </div>
  </div>
  <div class="main-content">
    <div class="controls">
      <div class="control-group">
        <label for="product-select">р╣Ар╕ер╕╖р╕нр╕Бр╕Фр╕╣р╣Ар╕Йр╕Юр╕▓р╕░р╕кр╕┤р╕Щр╕Др╣Йр╕▓:</label>
        <select id="product-select">
          <option value="">р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</option>
          <!-- р╣Ар╕Хр╕┤р╕б option р╕Фр╣Йр╕зр╕в JS -->
        </select>
      </div>
      <div class="control-group">
        <label for="period-type">р╣Ар╕ер╕╖р╕нр╕Бр╕Кр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓:</label>
        <select id="period-type">
          <option value="month">р╕гр╕▓р╕вр╣Ар╕Фр╕╖р╕нр╕Щ</option>
          <option value="quarter">р╕гр╕▓р╕вр╣Др╕Хр╕гр╕бр╕▓р╕к</option>
          <option value="year">р╕гр╕▓р╕вр╕Ыр╕╡</option>
        </select>
      </div>

      <div class="control-group">
        <label for="year-select" id="year-label">р╣Ар╕ер╕╖р╕нр╕Бр╕Ыр╕╡:</label>
        <select id="year-select"></select>
      </div>
    </div>
    <div id="inventory-info" style="margin-bottom: 24px; font-weight: bold; color: #d35400"></div>
    <canvas id="movementChart" width="900" height="400"></canvas>
  </div>
  <script type="module" src="../scripts/movement.js"></script>
  <script>
    const yearSelect = document.getElementById("year-select");
    const yearLabel = document.getElementById("year-label");

    async function populateYearSelect() {
      const { buyin, sale } = await fetchAll();
      const years = new Set();
      const safeDate = (d) => {
        try {
          return new Date(d);
        } catch {
          return new Date(NaN);
        }
      };
      (buyin || []).forEach((b) => {
        const dt = safeDate(b.buyindate ?? b.date);
        if (!isNaN(dt)) years.add(dt.getFullYear());
      });
      (sale || []).forEach((s) => {
        const dt = safeDate(s.saleoutdate ?? s.date);
        if (!isNaN(dt)) years.add(dt.getFullYear());
      });
      const sorted = Array.from(years).sort((a, b) => b - a);
      yearSelect.innerHTML = "";
      sorted.forEach((y) => {
        const opt = document.createElement("option");
        opt.value = y;
        opt.textContent = y;
        yearSelect.appendChild(opt);
      });
      if (sorted.length) yearSelect.value = sorted[0];
    }
  </script>
</body>

</html>